# 归档/冷热分离必须掌握知识点（对应 questions-engineering 题 2）

## 1. 归档的目标

### 概念

- 把低频访问的历史数据从在线库迁出，降低在线库容量、索引膨胀、备份成本与查询压力。

### 必会要点

- 明确“在线查询链路”：哪些查询必须查全量？哪些只查近数据？
- 明确“归档策略”：按时间分段、按业务状态分段、或两者结合。

## 2. 常见落地方案

### 方案 A：按时间分库/分表（或历史表）

- 在线表仅保留近 N 天（例如 90 天）。
- 历史表按月/季度存放，例如 `orders_2025_01`。

### 方案 B：在线表 + 冷库（例如 MySQL 历史库/ES/数仓）

- 在线库：承载交易链路与实时查询。
- 冷库：承载历史报表、审计、回溯。

### 必会要点

- 需要定义：
  - 归档触发（定时任务/消息驱动）
  - 归档一致性（归档前后如何校验）
  - 回查机制（线上查询是否需要穿透历史库）

## 3. 常见坑

- 没有改查询路径，导致线上查询在历史库穿透，延迟不可控。
- 归档任务与在线写入并发，缺少边界与幂等，造成重复/漏归档。

## 对应题目

- 题 2

## 考核要点/验收清单

- **验收项**：能给出一个可落地的归档方案（按时间分段/历史表/冷库），并写清楚“归档触发、归档一致性校验、回查机制”。
- **验收项**：能明确哪些查询必须查全量，哪些只查近数据，并描述查询路由策略。
- **验收项**：能指出至少 2 个归档常见坑（穿透查询、并发归档幂等/边界）。
