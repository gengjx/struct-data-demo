# 主键选型必须掌握知识点（对应 questions-engineering 题 1）

## 1. 主键的核心作用

### 概念

- 主键用于唯一标识一行记录。
- InnoDB 下主键是聚簇索引，数据按主键组织，主键设计会直接影响写入与范围查询。

### 必会要点

- 主键尽量：短、递增（或趋势递增）、不可变。
- 二级索引叶子节点存的是主键值：主键越大，二级索引越占空间。

## 2. 为什么不推荐 UUID 直接做主键

### 典型原因

- 随机插入导致 B+Tree 频繁页分裂，写放大。
- 聚簇索引下数据页不连续，降低缓存命中与范围扫描效率。
- UUID 体积大，二级索引都会存主键值，放大空间与 IO。

### 常见坑

- “UUID 做唯一键没问题”不等于“UUID 适合作为聚簇主键”。

## 3. 常见替代方案

### 方案

- 自增主键：单库单表简单可靠。
- 号段（segment）：服务端发号，趋势递增，性能好。
- 雪花（Snowflake）：分布式唯一、趋势递增，但要关注时钟回拨与 bit 规划。

### 必会要点

- 分布式场景关注：全局唯一、趋势递增、可观测（含时间信息）、容量上限。

## 对应题目

- 题 1

## 考核要点/验收清单

- **验收项**：能至少列出 3 点为什么不推荐 UUID 直接做主键（页分裂/写放大、空间放大、范围扫描差）。
- **验收项**：能说明“聚簇索引 + 二级索引存主键值”对主键长度的影响。
- **验收项**：能给出至少 2 种替代方案（自增/号段/雪花）并说明各自适用场景与风险点。
