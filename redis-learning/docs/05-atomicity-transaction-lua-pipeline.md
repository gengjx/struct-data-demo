# 05. 原子性、事务、Lua 与 Pipeline

## 1. 原子性

- Redis 单条命令是原子的（在命令执行层面）
- 多条命令组合通常不是原子的，除非：
  - 使用 Lua
  - 或使用事务（但事务语义与数据库不同）

## 2. 事务：MULTI/EXEC

- `MULTI`：开启事务
- `EXEC`：提交执行
- 特点：
  - 命令会排队执行
  - **不提供隔离级别与回滚语义**（执行出错不等于回滚）

## 3. Lua（高频必会）

- `EVAL` 执行 Lua，脚本整体作为一个原子操作
- 适合：扣库存、限流、解锁校验等

注意点：
- 脚本不能太慢（会阻塞主线程）
- 避免对大 key 做大量遍历

本仓库对应：
- 解锁脚本：`RedisLock`
- 限流脚本：`FixedWindowRateLimiter`

## 4. Pipeline

- 目的：减少网络 RTT，提高吞吐
- 风险：
  - 单次 pipeline 太大可能导致客户端/服务端内存压力
  - pipeline 不等于原子
